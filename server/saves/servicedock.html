<!DOCTYPE html>
<!-- 
Project Name: SPIKE Prime Web Interface
File name: servicedock.html
Author: Jeremy Jung
Last update: 7/7/20
Description: service dock markup
* this module can be only run with servicedock_index.html *
Credits/inspirations:
    Service Dock by Ethan Danahy
History: 
    Created by Jeremy on 7/5/20
LICENSE: MIT
(C) Tufts Center for Engineering Education and Outreach (CEEO)

-->
<link rel = "stylesheet" href = "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css">
<script src = "./libraries/jquery_351.js" type = "text/javascript"></script>
<script src = "./libraries/SLajaxlib.js" type = "text/javascript"></script>
<script src = "./libraries/hoverscript_jquery.js" type = "text/javascript"></script>
<div id = "servicedock">
    <div id = "explanation" style = "display: none">
        <center id = "target_ignore">
            Enabling flag on Google Chrome
        </center>
        <ol>
            <li>Go to the URL: chrome://flags</li>
            <li>Search "Experimental Web Platform"</li>
            <li><em>ENABLE</em> Experimental Web Platform (#enable-experimental-web-platform-features)</li>
            <li>Restart your Chrome web browser</li>
        </ol>
        <center id = "target_ignore">
            Connecting to SPIKE Prime hub
        </center>
        <ol>
            <li>Plug in your SPIKE Prime hub by USB to this computer (and turn it on)!</li>
            <li>Click "Connect" below and look for device: <em>"LEGO Technic Large Hub"</em></li>
        </ol>
        <center id = "target_ignore">
            Using systemlink
        </center>
        <ol>
            <li> insert Systemlink API key </li>
        </ol>
        <center id = "target_ignore">
            Using systemlink & UJSON RPC interface
        </center>
        <ol>
            <li> System Link & UJSON RPC interface opens when connected to both services</li>
            <li> use "cloudTagValue({tagPath})" to retrieve its current value from the cloud </li>
        </ol>
    </div>
    <div id = "explain">
        <button id = "explain_button" class = "SD_button">
            <i class = "fas fa-question"></i>
        </button>
    </div>
    <div id = "sl_service">
        <button id = "sl_button" class = "SD_button">
            <i class="fas fa-cloud"></i>
            <div class = "status"></div>
        </button>
        <div id = "apikey_input" style = "display:none">
            <center>
                API Key
                <input type = "text" id = "keyinputfield">
                <span id = "key_valid"> Invalid </span>
            </center>
        </div>
        <button id = "API_button" class = "SD_option" style = "display:none">
            <i class = "fas fa-cloud"></i>
            <div class = "status"></div>
        </button>
    </div>
    <div id = "spike_service">
        <button id = "spike_button" class = "SD_button">
            <i class="fas fa-th"></i>
            <div class = "status"></div>
        </button>
        <div id = "connection_input" style = "display:none">
            <center>
                Hub
                <input type=button id="connect" name="Connect" value="Connect">
                <span style="background-color: red" id="connection_status">Status: Disconnected</span>
            </center>
        </div>
        <button id = "ujsonrpc_button" class = "SD_option" style = "display:none">
            <i class = "fas fa-th"></i>
            <div class = "status"></div>
        </button>
        <button id = "graph_button" class = "SD_option" style = "display:none">
            <i class = "fas fa-chart-line"></i>
            <div class = "status"></div>
        </button>
        <button id = "slujson_button" class = "SD_option" style = "display:none">
            <i class = "fas fa-cloud-download-alt"></i>
            <div class = "status"></div>
        </button>
    </div>
</div>
<script>
    $(document).ready(new function() {

        //SD_buttons' states
        var toggle_question = false;
        var toggle_sl = false;
        var toggle_spike = false;

        /* Effects: 
        * - continuously checks if a valid API key was entered at servicedock_index.html (ASYNC INTERVAL)
        * - hides the input <div> in service dock when valid 
        */
        var check_APIkey_valid;
        check_APIkey_valid = setInterval( async () => {
            if (APIkey_valid_at_SD) {
                //valid APIkey was entered, so no need to check anymore
                clearInterval(check_APIkey_valid)
                $("#apikey_input").css("display","none");
                $("#API_button .status").css("background-color", "green");
                $("#sl_button .status").css("background-color", "green");
            }
        }, 500)

        /* Effects: 
        * - continuously checks if SPIKE Prime is connected (ASYNC INTERVAL)
        * - hides the input <div> in service dock when valid 
        */
        var check_port_connected;
        check_port_connected = setInterval( async () => {
            if (port_connected) {
                clearInterval(check_port_connected);
                $("#connection_input").css("display", "none");
                $("#spike_button .status").css("background-color", "green");
                $("#ujsonrpc_button .status").css("background-color", "green");
                $("#graph_button .status").css("background-color", "green");
                
            }
        }, 500)

        /* event listeners for all buttons for service dock visuals */

        /* Effects: 
        * - when spike_button is clicked, toggle scroll down submodular buttons
        */
        $("#spike_button").on("click", () => {
            var options = $("#spike_service .SD_option").get();
            if (toggle_spike) {
                $("#connection_input").css("display", "none");
                for (var i = 0; i < options.length; i++) {
                    options[i].style.display = "none";
                }
                toggle_spike = false;
            }
            else {
                if ( !port_connected ) {
                    $("#connection_input").css("display", "block");
                }
                for (var i = 0; i < options.length; i++) {
                    options[i].style.display = "block";
                }
                toggle_spike = true;
            }
        })
        
        /* Effects: 
        * - when sl_button is clicked, toggle scroll down submodular buttons
        */
        $("#sl_button").on("click", () => {
            var options = $("#sl_service .SD_option").get();
            if (toggle_sl) {
                $("#apikey_input").css("display", "none");
                for (var i = 0; i < options.length; i++) {
                    options[i].style.display = "none";
                }
                toggle_sl = false;
            } 
            else {
                if ( !APIkey_valid_at_SD ) {
                    $("#apikey_input").css("display", "block");
                }
                for (var i = 0; i < options.length; i++) {
                    options[i].style.display = "block";
                }
                toggle_sl = true;
            }
        })

        $("#explain_button").on("click", () => {
            if (toggle_question) {
                $("#explanation").css("display", "none");
                toggle_question = false;
            }
            else {
                $("#explanation").css("display", "block");
                toggle_question = true;
            }
        })

        dragElement("explanation")
    })

</script>

<style>
    .SD_button {
        background-color: #A2E1EF;
        border: none;
        color: white; 
        font-size: 30px; /*font-size determines size of loaded fa icon*/
        cursor: pointer; 
        margin: 4px 0px;
        border-radius: 10px;
        width: 50px;
        height: 50px;
        position: relative;
    }

    .SD_option {
        background-color: rgb(173, 245, 110);
        border: none; 
        color: white; 
        font-size: 25px; /*font-size determines size of loaded fa icon*/
        cursor: pointer; 
        margin: 4px 0px;
        border-radius: 10px;
        width: 40px;
        height: 40px;
        position: relative;
    }

    .SD_button .status {
        height: 15px;
        width: 15px;
        background-color: red;
        border-radius: 50%;
        position: absolute;
        margin: -4px 34px;
    }

    .SD_option .status {
        height: 15px;
        width: 15px;
        background-color: red;
        border-radius: 50%;
        position: absolute;
        margin: -4px 25px;
    }

    #connection_input {
        position: relative;
        top:5px;
        height: 40px;
        width: 260px;
        margin:10px;
        background-color: rgb(173, 245, 110);
    }   

    #apikey_input { 
        position: relative; 
        top:5px;    
        height: 40px;
        width: 260px;
        margin:10px;
        background-color: rgb(173, 245, 110);
    }

    .SD_button:hover, .SD_option:hover {
        color:#000000;
        background-color:#FFFFFF;
    }

    #explanation {
        position: absolute;
        left: 200px;
        background-color: #A2E1EF;
        height: 500px;
        width: 500px;
    }
</style>