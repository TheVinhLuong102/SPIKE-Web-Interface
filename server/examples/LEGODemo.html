<!DOCTYPE html>
<html>
    <head>
    </head>
    <body>
        <div id = "changeLEGOSpeed">
            <div id = "currentSpeed"> Ethan's Current Motor Speed: </div>
            <input type="range" min="-100" max="100" value="0" class="slider" id="speedRange">
        </div>
        <div id = "changeMessage">
            <div id="currentMessage"> Jeremy's Last Message on Hub: </div>
            <input type = "text" id="text" value = "Hello World!"></textarea>
            <div>
                <input type="button" id="display" value="display">
            </div>
        </div>
    </body>
    <script>
        // instantiate systemlink service object
        var mySL = new Service_SystemLink();
        
        var LEGOSpeed;
        var message;

        var currentSpeed;
        var currentMessage;

        var currentSpeedDIV = document.getElementById("currentSpeed");
        var currentMessageDIV = document.getElementById("currentMessage");
        var textArea = document.getElementById("text");
        var changeButton = document.getElementById("display");

        window.addEventListener("load", function () {
            mySL.init();
        })

        var slider = document.getElementById("speedRange");
        LEGOSpeed = parseFloat(slider.value); // Display the default slider value
        console.log(LEGOSpeed);

        // Update the LEGOSpeed when slider is scrolled
        slider.oninput = function () {
            LEGOSpeed = parseFloat(this.value);
        }
        
        mySL.executeAfterInit( async function () {

            currentSpeed = await mySL.getTagValue("LEGOSpeed");
            currentMessage = await mySL.getTagValue("message");

            /* update and get "LEGOSpeed" and "message" tag values every 100 miliseconds */
            var SLInterval = setInterval(async function () {
                console.log("LEGOSpeed", LEGOSpeed);
                console.log("typeof LEGOSpeed", typeof LEGOSpeed);
                /* update tag values */
                mySL.setTagValue("LEGOSpeed", LEGOSpeed);

                /* get all tags on the cloud */
                var tagsInfo = await mySL.getTagsInfo();

                /* get "LEGOSpeed" and "message" tag values */
                currentSpeed = tagsInfo.LEGOSpeed.value;
                currentMessage = tagsInfo.message.value;

                currentSpeedDIV.innerHTML = "Ethan's Current Motor Speed: " + currentSpeed;
                currentMessageDIV.innerHTML = "Jeremy's Last Message on Hub: " + currentMessage;

            }, 100);

            changeButton.addEventListener("click", function () {
                
                message = textArea.value;
                console.log("message", message);
                console.log("typeof message", typeof message);
                mySL.setTagValue("message", message);
            })
        });
        function Service_SystemLink() { let e = {}, t = "daciN5xlHb-J_eABvDQPRIYt4jrKmbUbCl-Zc2vta7", n = !1, a = 1e3; var r = void 0; async function o() { return e } async function i(e, t, n, a) { var r = new XMLHttpRequest; if (r.open(e, t, !0), r.setRequestHeader("x-ni-api-key", n), void 0 === a) r.setRequestHeader("Accept", "application/json"), r.send(); else { r.setRequestHeader("Content-type", "application/json"); var o = JSON.stringify(a); try { r.send(o) } catch (e) { console.log("error sending request:", r.response) } } return r } function s(e, t) { return "BOOLEAN" == e ? "true" == t : "STRING" == e ? t : "INT" == e || "DOUBLE" == e ? parseFloat(t) : t } return { init: async function (n, o) { var u; return void 0 !== n && (t = n), !!await async function (e) { return new Promise(async function (t, n) { var a = await i("GET", "https://api.systemlinkcloud.com/niauth/v1/auth", e); a.onload = function () { var e = JSON.parse(a.response); e.error ? n(new Error("Error at apikey auth:", e)) : (console.log("APIkey is valid"), t(!0)) }, a.onerror = function () { var e = JSON.parse(a.response); n(new Error("Error at apikey auth:", e)) } }) }(t) && (void 0 !== o && (a = await o), async function () { setInterval(async function () { var n = await async function () { return new Promise(async function (e, n) { var a = {}, r = await i("GET", "https://api.systemlinkcloud.com/nitag/v2/tags-with-values", t); r.onload = async function () { for (var t = JSON.parse(this.response), n = t.tagsWithValues, r = t.totalCount, o = 0; o < r; o++)try { var i = n[o].current.value.value, u = n[o].current.value.type, c = n[o].tag.path, l = await s(u, i), v = {}; v.value = l, v.type = u, a[c] = v } catch (e) { var i = null, u = n[o].tag.type, c = n[o].tag.path, v = {}; v.value = i, v.type = u, a[c] = v } e(a) }, r.onerror = function () { n(new Error("Error at getTagsInfoFromCloud")) } }) }(); n && (e = n) }, a) }(), active = !0, await (u = 2e3, new Promise(e => setTimeout(e, u))), void 0 !== r && r(), !0) }, getTagsInfo: o, setTagValue: async function (e, n) { return async function (e, n) { return new Promise(async function (a, r) { var o, s = "https://api.systemlinkcloud.com/nitag/v2/tags/" + e + "/values/current", u = (o = n, isNaN(o) ? "true" == o || "false" == o ? "BOOLEAN" : "STRING" : Number.isInteger(parseFloat(o)) ? "INT" : "DOUBLE"); if ("STRING" != u) var c = JSON.stringify(n), l = { value: { type: u, value: c } }; else var l = { value: { type: u, value: n } }; var v = l, p = await i("PUT", s, t, v); p.onload = function () { a(!0) }, p.onerror = function () { r(new Error("Error at updateTAagValue")) } }) }(e, n) }, getTagValue: async function (e) { return (await o())[e].value }, executeAfterInit: function (e) { r = e }, setAPIKey: function (e) { t = e }, isActive: function () { return n } } }
    </script>
    <style>

        #changeLEGOSpeed {
            font-size: 20px;
            position:absolute;

            left: 50%;
            top: 25%;

            background-color: rgb(40, 165, 153);
            width: 400px;
            height: 200px;
            border:solid;
        }

        #display {
            font-size: 20px;
        }

        #speedRange {
            width: 300px;
        }

        #text {
            height: 125px;
            width: 200px;
            font-size: 20px;
        }

        #changeMessage {
            font-size: 20px;
            position: absolute;
            
            left: 10%;
            top: 25%;

            background-color: rgb(40, 165, 153);
            width: 400px;
            height: 200px;
            border:solid;
        }

        body {
            background-color: #4CE0D2;
        }

    </style>
</html>