<html>

    <head>
        <!--
            <script src="./modules/ServiceDock_GeoLocation.js"></script>
            <script src="./modules/ServiceDock_Gmail.js"></script>
            <script src = "./modules/ServiceDock.js" type = "text/javascript"></script>
        -->
            <script src="./modules/ServiceDock_SPIKE.js"></script>
            <script src="./modules/ServiceDock_SystemLink.js"></script>
            <script src="./modules/ServiceDock_Airtable.js" type = "text/javascript"></script>

        <script src="./modules/libraries/jquery_351.js" type="text/javascript"></script>
        <script src="./modules/libraries/hoverscript_jquery.js" type="text/javascript"></script>
        <!-- <script src = "https://cdn.jsdelivr.net/gh/tuftsceeo/SPIKE-Web-Interface/cdn/ServiceDock.min.js"></script> -->
    </head>

    <body style="background-image: url('./examples/modules/views/CEEOInnovationsbackground.png');">
        <div id="servicedock" style="float:left;">
            <service-spike id="service_spike"></service-spike>

            <service-systemlink id="service_systemlink" 
            apikey = "daciN5xlHb-J_eABvDQPRIYt4jrKmbUbCl-Zc2vta7"></service-systemlink>
            
            <!--<service-systemlink id ="service_systemlink"></service-systemlink>-->
            <!--<service-airtable id="service_airtable" apikey = "keyFiNlvyTdd2Vs1b" baseid = "appHoo8e4oPG9YJIH" tablename = "Artists"></service-airtable>-->
            <service-airtable id="service_airtable">
            </service-airtable>
            <service-gmail ></service-gmail>
            <service-geolocation></service-geolocation>
       

            
        </div>
        <div id = "onlyForWriteProgram" >
            <textarea id="writeProgramData" name="data" value=""
                style="font-family: Courier; position: relative; left: 20px; z-index: 5;" /></textarea>
            <input style = "position: relative; left: 20px;" type="button" id = "writeTheProgram" value="write program">
        </div>
        <div id = "SPIKEbox">
            <select id="SPIKEselectTest">
                <option id="motorOPTION"> motor functions </option>
                <option id="motorPairOPTION"> motorPair functions </option>
                <option id="motionOPTION"> motion sensor functions </option>
                <option id="forceOPTION"> force sensor functions </option>
                <option id="speakerOPTION"> Primehub.speaker functions </option>
                <option id="buttonOPTION"> Primehub.button functions </option>
                <option id="colorOPTION"> Color sensor functions </option>
                <option id="ultrasonicOPTION"> Distance Sensor functions </option>
                <option id="programOPTION"> write program functions </option>
                <option id="miscOPTION"> miscellaneous functions </option>
            </select>
            <input type="button" id="SPIKE_test_select" value="display test cases for this function">
            <div id="SPIKEtests">
                <!-- motor functions -->
                <input type="button" id="motorrelpos" class="SPIKEtestCase motor" value="motor go to rel pos ( with stall detection )">
                <input type="button" id="motorrelpos1" class="SPIKEtestCase motor" value="motor go to rel pos ( NO stall detection )">
                <input type="button" id="degreesCounted" class="SPIKEtestCase motor" value="motor get degrees counted">
                <input type="button" id="motorPosition" class="SPIKEtestCase motor" value="motor get position">
                <input type="button" id="getPower" class="SPIKEtestCase motor" value="motor get power">
                <input type="button" id="getSpeed" class="SPIKEtestCase motor" value="motor get speed">
                <input type="button" id="motorStartAtPower" class="SPIKEtestCase motor" value="motor startAtPower">

                <!-- motor pair functions -->
                <input type="button" id="motorPairMove" class="SPIKEtestCase motorPair" value="motorPair move(100, 'cm', 0, 100)">
                <input type="button" id="motorPairMoveLeft" class="SPIKEtestCase motorPair" value="motorPair move left (steering: -100) ">
                <input type="button" id="motorPairMoveRight" class="SPIKEtestCase motorPair" value="motorPair move right (steering: 100)">
                <input type="button" id="motorPairMoveLeftSlightly" class="SPIKEtestCase motorPair" value="motorPair move left (steering: -50) ">
                <input type="button" id="motorPairMoveRightSlightly" class="SPIKEtestCase motorPair" value="motorPair move right (steering: 50)">
                <input type="button" id="motorPairStart" class="SPIKEtestCase motorPair" value="motorPair start(0, 100)">
                <input type="button" id="motorPairStartLeft" class="SPIKEtestCase motorPair" value="motorPair start left">
                <input type="button" id="motorPairStartRight" class="SPIKEtestCase motorPair" value="motorPair start right">
                <input type="button" id="motorPairStop" class="SPIKEtestCase motorPair" value="motorPair stop()">
                
                <!-- motion sensor functions-->
                <input type="button" id="waitForNewGesture" class="SPIKEtestCase motion" value="wait_for_new_gesture test">
                <input type="button" id="wasGesture" class="SPIKEtestCase motion" value="was_gesture test">
                <input type="button" id="waitForNewOri" class="SPIKEtestCase motion" value="wait_for_new_orientation test">
                <input type="button" id="getAngles" class="SPIKEtestCase motion" value = "get angles test">
                <input type="button" id="resetYaw" class="SPIKEtestCase motion" value="reset yaw angle() test">
                <input type="button" id="resetYawSource" class="SPIKEtestCase motion" value="reset yaw angle() source code test">
                <input type="button" id="getGesture" class="SPIKEtestCase motion" value="getGesture() test">
                <input type="button" id="getOrientation" class="SPIKEtestCase motion" value="getOrientation() test">
                
                <!-- Force sensor functions-->
                <input type="button" id="getForceNewton" class="SPIKEtestCase force" value="get_force_newton() test">
                <input type="button" id="getForcePercentage" class="SPIKEtestCase force" value="get_force_percentage() test">
                <input type="button" id="forceSensorIsPressed" class="SPIKEtestCase force" value="is_pressed() test">
                <input type="button" id="forceSensorWaitUntilPress" class="SPIKEtestCase force" value="wait_until_pressed() test">
                <input type="button" id="forceSensorWaitUntilRelease" class="SPIKEtestCase force" value="wait_until_released() test">
                
                <!-- speaker functions-->
                <input type="button" id="beep" class="SPIKEtestCase speaker" value="beep(note,seconds) test">
                <input type="button" id="startBeep" class="SPIKEtestCase speaker" value="startBeep(note) test">
                <input type="button" id="stopBeep" class="SPIKEtestCase speaker" value="speaker.stop() test">
                
                <!-- button functions-->
                <input type="button" id="buttonWaitPress" class="SPIKEtestCase button" value="left and right button.wait_until_pressed(callback)">
                <input type="button" id="buttonWaitRelease" class="SPIKEtestCase button" value="left and right button.wait_until_released(callback)">
                <input type="button" id="buttonWasPress" class="SPIKEtestCase button" value="left and right button.was_pressed()">
                <input type="button" id="buttonIsPress" class="SPIKEtestCase button" value="left and right button.is_pressed()">
                
                <!-- color sensor functions -->
                <input type="button" id="getColor" class="SPIKEtestCase color" value="get color test">
                <input type="button" id="waitUntilColor" class="SPIKEtestCase color" value="wait until color test">
                
                <!-- color sensor functions -->
                <input type="button" id="lightup" class="SPIKEtestCase ultrasonic" value="ultrasonic light up">

                <!-- write Program functions -->
                <input type="button" id="writeProgram" class="SPIKEtestCase program" value="test write program">
                <input type="button" id="concatenateProgram" class="SPIKEtestCase program" value="test source code for concatenating micropy program">
                <input type="button" id="getProjects" class="SPIKEtestCase program" value="test getProjects()">
                <input type="button" id="parseUJSON" class="SPIKEtestCase program" value="test parseUJSONRPC source code">
                <input type="button" id="micropython" class="SPIKEtestCase program" value="test micropython tempalte literal">
                <input type="button" id="waitForSeconds" class="SPIKEtestCase program" value="test wait_for_seconds">

                <!-- SPIKE Library functions-->
                <input type="button" id="setHubOri" class="SPIKEtestCase misc" value="setHubOrientation()">
                <input type="button" id="testUJSONRPC" class="SPIKEtestCase misc" value="test UJSONRPC.displayText()">
                <input type="button" id="testNewKeyword" class="SPIKEtestCase misc" value="new Motor() vs Motor()">
                <input type="button" id="testNewKeyword1" class="SPIKEtestCase misc" value="Motor() vs Motor() declared without 'new' keyword">
                <input type="button" id="testGetMotors" class="SPIKEtestCase misc" value="getMotors">
                <input type="button" id="getMotorPorts" class="SPIKEtestCase misc" value="get motorports">

                <input type="button" id="displayClear" class="SPIKEtestCase misc" value="UJSON displayClear()">
                <input type="button" id="displaySetPixel" class="SPIKEtestCase misc" value="UJSON displaySetPixel(0,0, 100)">
                <input type="button" id="displayText" class="SPIKEtestCase misc" value="displayText('hello')">
                <input type="button" id="motorGoRelPos" class="SPIKEtestCase misc" value="motorGoRelPos('A',180,100,true,true)">
                <input type="button" id="motorGoRelPos1" class="SPIKEtestCase misc" value="motorGoRelPos('A',180,100,false,true)">
                <input type="button" id="motorGoRelPos2" class="SPIKEtestCase misc" value="motorGoRelPos('A',180,100,true,false)">
                <input type="button" id="motorGoRelPos3" class="SPIKEtestCase misc" value="motorGoRelPos('A',180,100,false,false)">
                <input type="button" id="motorPwm" class="SPIKEtestCase misc" value="motorPwm('A',100,true)">
                <input type="button" id="motorPwm1" class="SPIKEtestCase misc" value="motorPwm('A',100,false)">
                <input type="button" id="motorRunDegrees" class="SPIKEtestCase misc" value="motorRunDegrees('A',400, 100, true, true)">
                <input type="button" id="motorRunDegrees1" class="SPIKEtestCase misc" value="motorRunDegrees('A',400, 100, false, true)">
                <input type="button" id="motorRunDegrees2" class="SPIKEtestCase misc" value="motorRunDegrees('A',400, 100, true, false)">
                <input type="button" id="motorRunDegrees3" class="SPIKEtestCase misc" value="motorRunDegrees('A',400, 100, false, false)">
                <input type="button" id="motorRunTimed" class="SPIKEtestCase misc" value="motorRunTimed('A',3000,100,true,true)">
                <input type="button" id="motorRunTimed1" class="SPIKEtestCase misc" value="motorRunTimed('A',3000,100,false,true)">
                <input type="button" id="motorRunTimed2" class="SPIKEtestCase misc" value="motorRunTimed('A',3000,100,true,false)">
                <input type="button" id="motorRunTimed3" class="SPIKEtestCase misc" value="motorRunTimed('A',3000,100,false,false)">
                <input type="button" id="motorStart" class="SPIKEtestCase misc" value="motorStart('A',100,true)">
                <input type="button" id="motorStart1" class="SPIKEtestCase misc" value="motorStart('A',100,false)">
                <input type="button" id="moveTankDegrees" class="SPIKEtestCase misc" value="moveTankDegrees(300, 100, 100, 'A', 'B',true)">
                <input type="button" id="moveTankDegrees1" class="SPIKEtestCase misc" value="moveTankDegrees(300, 100, 100, 'A', 'B',false)">
                <input type="button" id="moveTankPowers" class="SPIKEtestCase misc" value="moveTankPowers(100, 100, 'A', 'B')">
                <input type="button" id="moveTankSpeeds" class="SPIKEtestCase misc" value="moveTankSpeeds(100, 100, 'A', 'B')">
                <input type="button" id="moveTankTime" class="SPIKEtestCase misc" value="moveTankTime(3000, 100, 100, 'A', 'B',true)">
                <input type="button" id="moveTankTime1" class="SPIKEtestCase misc" value="moveTankTime(3000, 100, 100, 'A', 'B',false)">
                <input type="button" id="soundBeep" class="SPIKEtestCase misc" value="soundBeep(100, 300)">
                <input type="button" id="soundStop" class="SPIKEtestCase misc" value="soundStop()">
                <input type="button" id="random" class="SPIKEtestCase misc" value="random">
                <div id="chart"></div>
            </div>
        </div>

        <div id="SLbox">
            <div>
                <select id="SLselectTest">
                    <option id="getTagsInfoOPTION">getTagsInfo</option>
                    <option id="createNewTagOPTION"> createNewTag </option>
                    <option id="deleteTagOPTION"> deleteTag </option>
                    <option id="setTagValueOPTION"> setTagValue </option>
                </select>
                <input type = "button" id = "SL_test_select" value = "display test cases for this function">
            </div>
            <div id = "SLtests">

                <!--      getTagsInfo CASES      -->
                <input type="button" id="getTagsInfo"  class = "SLtestCase getTagsInfo" value="getTagsInfo"> <!-- regular -->
                
                <!-- (when there are no tags)-->
                <input type="button" id="getTagsInfo1" class = "SLtestCase getTagsInfo" value="getTagsInfo when there are no tags">
                
                <!-- createNewTag CASES-->
                <input type="button" id="createNewTag" class = "SLtestCase createNewTag" value="create new tag ('newTag')">
                
                <!--deleteTag CASES -->
                <!-- (when tag to delete exists) -->
                <input type="button" id="deleteTag"    class = "SLtestCase deleteTag" value="delete tag ('newTag')">
                
                <!-- (when tag to delete doesn't exist)-->
                <input type="button" id="deleteTag1" class="SLtestCase deleteTag" value= "delete tag ('newTag') when it doesnt exist">

                <!-- (when tag to delete doesn't exist)-->
                <input type="button" id="deleteTag2" class="SLtestCase deleteTag" value="jsut delete tag ('newTag')">
                
                <!-- setTagValue CASES -->
                <!-- setTagValue without callback-->
                <input type="button" id="setTagValue" class="SLtestCase setTagValue" value="create 'newTag' with value 4 and change it to 5">
                <input type="button" id="setINTtagwithString" class="SLtestCase setTagValue"
                    value="set an INT tag's value with a string input">
                <input type="button" id="setINTtagwithNumber" class="SLtestCase setTagValue"
                    value="set an INT tag's value with a number input">
                <input type="button" id="setSTRINGtagwithString" class="SLtestCase setTagValue"
                    value="set a string tag's value with a string input">
                <input type="button" id="setSTRINGtagwithNumber" class="SLtestCase setTagValue"
                    value="set a string tag's value with a number input">
                <input type="button" id="setBOOLEANtagwithString" class="SLtestCase setTagValue"
                        value="set a BOOLEAN tag's value with a string input">
            </div>
            
        </div>
    

        
    </body>
    <script>
        var mySLElement = document.getElementById("service_systemlink");
        var AirtableElement = document.getElementById("service_airtable");
        
        //mySLElement.setAttribute("apikey", "daciN5xlHb-J_eABvDQPRIYt4jrKmbUbCl-Zc2vta7"); // this works too,
        var mySL = mySLElement.getService();
        var Airtable = AirtableElement.getService();
        var mySPIKE = document.getElementById("service_spike").getService();
        var hub = new mySPIKE.PrimeHub();

        /* Testing automatic initialization of SD Airtable JEREMY CODE */
        AirtableElement.setAttribute("apikey", "keyFiNlvyTdd2Vs1b");
        AirtableElement.setAttribute("baseid", "appHoo8e4oPG9YJIH");
        // NOTE: the tablename is "Example", not "Artists" to simulate students' workspace
        AirtableElement.setAttribute("tablename", "Example");
        console.log("SL Service is active: ", mySL.isActive());
        /* End testing automatic init */
        console.log("Service is active: ", Airtable.isActive());
        /* set function to execute after init*/
        Airtable.executeAfterInit( async function() {
            console.log("Service is active: ", Airtable.isActive());
            /* begin testing Airtable getter functions */

            // get all the "Name" fields on the table
            var names = Airtable.getNames();
            console.log(names);

            // get all the "Value" fields associated with a "Name"
            for ( var index in names ) {
                var value = Airtable.getValue(names[index]);
                console.log("value of " + names[index] + " is: ", value);
            }

            /* end testing Airtable getter functions */

            /* begin testing setter functions */

            // creates new data and pushes it to Airtable
            Airtable.createNameValuePair("newTag", "testNewTag");
            // var test1 = Airtable.createName({ Name: "Happy", Value: "2"});
            // console.log(test1)

            // updates existing info entry in Airtable
            // var test2 = Airtable.updateName("recc3GIbPuDbIIk8T", {Name: "Mom", Value: "3"});
            // console.log(test2)
            // Airtable.updateValue("Grace", "hi hi")
            // Airtable.updateValue("hee", true)
            // Airtable.updateValue("ho", false)
            // Airtable.updateValue("Baby", 1)
            
            /* end testing setter functions */
        });

        /* initialize Airtable */
        AirtableElement.init();
        
        /* Testing automatic initialization of SD Airtable */
        mySL.executeAfterInit(function() {
            console.log("SL Service is active: ", mySL.isActive());
        })
        //var mySL = document.getElementById("service_systemlink").getService();
        var output = document.getElementById("output");

        //////////////////////////////////////////
        //                                      //
        //             SPIKE Testing            //
        //                                      //
        //////////////////////////////////////////
        
        //                                      //
        //              Motor Tests             //
        //                                      //

        /* go to rel pos stall detection */
        var testMotorRelPos = document.getElementById("motorrelpos");
        testMotorRelPos.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON motor.run_to_position(100) #######");
            console.log("Test: motor connected to port A will move to a certain position.\n" +
            "Check stall detection: Hold the motor. Because stall detect is on, the motor will stop after it being unable to move for some time" + "\n" +
            "Check stall detection response: (example response that detected stall: {'i':4973,'r':2})" + "if not detect stall: {'i':2117,'r':0}");
            var motor = new mySPIKE.Motor("A");
            motor.set_default_speed(50);

            motor.set_stall_detection(true);
            
            motor.run_to_position(180);

            console.log("default speed", motor.get_default_speed());

            console.log("###### ENDING UNIT TEST ON motor.run_to_position(100) #######");

        })

        /* go to rel pos without stall detection */
        var testMotorRelPos1 = document.getElementById("motorrelpos1");
        testMotorRelPos1.addEventListener("click", async function () {

            var motor = new mySPIKE.Motor("A");
            motor.set_default_speed(50);
            
            motor.set_stall_detection(false);
            
            motor.run_to_position(180, 100, function() {
                console.log("done");
            });

            console.log(motor.get_default_speed());

        })

        /* go to rel pos without stall detection */
        var testMotorStartAtPower = document.getElementById("motorStartAtPower");
        testMotorStartAtPower.addEventListener("click", async function () {

            var motor = new mySPIKE.Motor("A");
            motor.run_for_degrees(30,100);

        })

        //                                      //
        //           MotorPair Tests            //
        //                                      //

        var testMotorPairStop = document.getElementById("motorPairStop");
        testMotorPairStop.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motorPair.stop() #######");
            console.log("Test: stop the motorPair of motors connected to A and B");

            var motorPair = new mySPIKE.MotorPair("A","B");

            motorPair.stop();

            console.log("###### ENDING UNIT TEST ON motorPair.stop() #######");
        })

        var testMotorPairMove = document.getElementById("motorPairMove");
        testMotorPairMove.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motorPair.move(100, 'cm', 0, 100) #######");
            console.log("Test: moving the driving base 100 cm with 0 steering on speed of 100");

            var motorPair = new mySPIKE.MotorPair("A", "B");

            motorPair.move(100, "cm", 0, 100);

            console.log("Expected result: base moving forward without turning and stopping at 100 cm");

            console.log("###### ENDING UNIT TEST ON motorPair.move() #######");
        })

        var testMotorPairStart = document.getElementById("motorPairStart");
        testMotorPairStart.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motorPair.start() #######");
            console.log(" Test: moving the drving base with 0 steering on speed of 100");

            var motorPair = new mySPIKE.MotorPair("A", "B");

            motorPair.start(0, 100);

            console.log("Expected result: base moving forward without turning");

            console.log("###### ENDING UNIT TEST ON motorPair.start() #######");
        })

        var testMotorPairMoveLeft = document.getElementById("motorPairMoveLeft");
        testMotorPairMoveLeft.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motorPair.move(100, 'cm', -100, 100) #######");
            
            var motorPair = new mySPIKE.MotorPair("A", "B");

            motorPair.move(100, "cm", -100, 100);

            console.log("Expected result: driving base moving left and stopping")
            console.log("###### ENDING UNIT TEST ON motorPair.move(100, 'cm', -100, 100) #######");

        })

        var testMotorPairMoveRight = document.getElementById("motorPairMoveRight");
        testMotorPairMoveRight.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motorPair.move(100, 'cm', 100, 100) #######");
            
            var motorPair = new mySPIKE.MotorPair("A", "B");
            
            motorPair.move(100, "cm", 100, 100);
            
            console.log("Expected result: driving base moving right and stopping")
            console.log("###### ENDING UNIT TEST ON motorPair.move(100, 'cm', 100, 100) #######");
        })


        var testMotorPairMoveLeftSlightly = document.getElementById("motorPairMoveLeftSlightly");
        testMotorPairMoveLeftSlightly.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motorPair.move(100, 'cm', -50, 100) #######");

            var motorPair = new mySPIKE.MotorPair("A", "B");

            motorPair.move(100, "cm", -50, 100);

            console.log("Expected result: driving base moving left SLIGHTLY and stopping")
            console.log("###### ENDING UNIT TEST ON motorPair.move(100, 'cm', -50, 100) #######");

        })

        var testMotorPairMoveRightSlightly = document.getElementById("motorPairMoveRightSlightly");
        testMotorPairMoveRightSlightly.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motorPair.move(100, 'cm', 50, 100) #######");

            var motorPair = new mySPIKE.MotorPair("A", "B");

            motorPair.move(100, "cm", 50, 100);

            console.log("Expected result: driving base moving right SLIGHTLY and stopping")
            console.log("###### ENDING UNIT TEST ON motorPair.move(100, 'cm', 50, 100) #######");
        })

        //                                      //
        //         Motion Sensor Tests          //
        //                                      //

        /* wait for new gesture */
        var testWaitForNewGesture = document.getElementById("waitForNewGesture");
        testWaitForNewGesture.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON motionSensor.wait_for_new_gesture(callback) #######")
            console.log("Test: Program will detect either 'tapped' or 'doubletapped' gestures. Tap the hub display");

            
            hub.motion_sensor.wait_for_new_gesture( function(gesture) {

                console.log(">>> in callback")
                
                console.log(">>> gesture argument in callback, ", gesture);
                
                if (gesture == "tapped") {
                    console.log(">>> tapped event handler");
                    console.log("###### ENDING UNIT TEST ON motionSensor.wait_for_new_gesture(callback) #######")
                }
                else if ( gesture == "doubletapped" ) {
                    console.log(">>> doubletapped event handler");
                    console.log("###### ENDING UNIT TEST ON motionSensor.wait_for_new_gesture(callback) #######")
                }
                else {
                    console.log("###### ENDING UNIT TEST ON motionSensor.wait_for_new_gesture(callback) #######")
                }
            })
            
        })

        /* was gesture */
        var testWasGesture = document.getElementById("wasGesture");
        testWasGesture.addEventListener("click", async function () {
            
            console.log("###### BEGINNING UNIT TEST ON motion_sensor.was_gesture('doubletapped') #######")
            console.log("Test (First Time): Sees if 'doubletapped' gesture has occurred since the beginning of the program (for the first use).");
            console.log("Test (Second Time): Sees if 'doubletapped' gesture has occurred since the last execution of was_gesture().");
            
            if (hub.motion_sensor.was_gesture("doubletapped")) {
                console.log(">>> doubletapped did occur");
            } else {
                console.log(">>> doubletapped did NOT occur ");
            }

            console.log("###### ENDING UNIT TEST ON motion_sensor.was_gesture('doubletapped') #######")
        })

        /* wait for new orientation */
        var testWaitForNewOri = document.getElementById("waitForNewOri");
        testWaitForNewOri.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON motion_sensor.wait_for_new_orientation(callback) #######")
            console.log("Test (First Time): the returned orientation will be the current orientation.");
            console.log("Test (Second Time): Sees if there's a new orientation different from the previously detected");

            console.log(">>> change the orientation of the hub");
            hub.motion_sensor.wait_for_new_orientation( function ( orientation ) {

                if ( orientation ) {
                    console.log(">>> the orientation is ", orientation);
                    console.log("###### ENDING UNIT TEST ON motionSensor.wait_for_new_orientation(callback)#######");
                }
            })
            
        })

        var testGetAngles = document.getElementById("getAngles");
        testGetAngles.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON motion_sensor get_***_angle() functions #######");
            
            console.log("yaw angle: ", hub.motion_sensor.get_yaw_angle());
            console.log("pitch angle: ", hub.motion_sensor.get_pitch_angle());
            console.log("roll angle: ", hub.motion_sensor.get_roll_angle());
            console.log("###### ENDING UNIT TEST ON get_***_angle() functions #######");
        })

        var testGetGesture = document.getElementById("getGesture");
        testGetGesture.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motion_sensor.get_gesture() #######");
            
            var gesture = hub.motion_sensor.get_gesture();
            console.log("gesture: ", gesture);
            
            console.log("###### ENDING UNIT TEST ON motion_sensor.get_gesture() #######");
        })

        var testGetOrientation = document.getElementById("getOrientation");
        testGetOrientation.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motion_sensor.get_orientation() #######");


            var orientation = hub.motion_sensor.get_orientation();
            console.log("orientation: ", orientation);

            console.log("###### ENDING UNIT TEST ON motion_sensor.get_orientation() #######");
        })

        var testResetYaw = document.getElementById("resetYaw");
        testResetYaw.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON motion_sensor.reset_yaw_angle() #######");
            console.log("Test: reset yaw angle and get yaw angle after 3 seconds");
            

            hub.motion_sensor.reset_yaw_angle();

            setTimeout(function () {
                console.log(hub.motion_sensor.get_yaw_angle());
            }, 3000 );

            console.log("###### ENDING UNIT TEST ON motion_sensor.reset_yaw_angle() #######");
        })

        var testResetYawSource = document.getElementById("resetYawSource");
        testResetYawSource.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST (logic) ON motion_sensor.reset_yaw_angle() #######");
            /* randomly generate current position */
            // get the digits
            var currPos = Math.floor(Math.random() * 1000);
            while ( currPos > 180 ) {
                currPos = Math.floor(Math.random() * 1000)
            }

            // get the sign
            var negativeOrPositive = Math.random() * 1000;
            if (negativeOrPositive > 500) {
                var currPos = currPos * -1;
            }

            console.log("current position: ", currPos)

            /* randomly generate new origin */
            // get the digits
            var newOrigin = Math.floor(Math.random() * 1000);
            while (newOrigin > 180) {
                newOrigin = Math.floor(Math.random() * 1000);
            }

            // get the sign
            var negativeOrPositive = Math.random() * 1000;
            if (negativeOrPositive > 500) {
                var newOrigin = newOrigin * -1;
            }

            console.log("new origin", newOrigin);

            var difference = currPos - newOrigin;


            if ( -180 > difference && difference > -360 ) {
                var newPos = Math.abs(difference) % 180;
            }
            else if ( 180 < difference && difference < 360 ) {
                var newPos = (Math.abs(difference) % 180) * -1;
            }
            else {
                console.log("difference", difference);
                var newPos = difference % 360;
            }

            console.log("translated position: ", newPos);
        })

        //                                      //
        //        Force Sensor Tests            //
        //                                      //
        
        var testGetForceNewton = document.getElementById("getForceNewton");
        testGetForceNewton.addEventListener("click", async function() {
            console.log("###### BEGINNING UNIT TEST ON ForceSensor.get_force_newton() #######");
            console.log("Test: Execute this test while pressing on a Force Sensor connected at port A");
            var force_sensor = new mySPIKE.ForceSensor("A");
            var newtons = force_sensor.get_force_newton();
            console.log("Force in Newtons: ", newtons);
            console.log("Expected Result: [1 to 10] reading on force on sensor");
            console.log("###### ENDING UNIT TEST ON ForceSensor.get_force_newton() #######");
        })

        var testGetForcePercentage = document.getElementById("getForcePercentage");
        testGetForcePercentage.addEventListener("click", function() {
            console.log("###### BEGINNING UNIT TEST ON ForceSensor.get_force_percentage() #######");
            console.log("Test: Execute this test while pressing on a Force Sensor connected at port A");
            var force_sensor = new mySPIKE.ForceSensor("A");
            var percentage = force_sensor.get_force_percentage();
            console.log("Force in percentage: ", percentage);
            console.log("Expected Result: [0 to 100] reading of force on sensor");
            console.log("###### ENDING UNIT TEST ON ForceSensor.get_force_percentage() #######");
        })

        var testForceSensorIsPressed = document.getElementById("forceSensorIsPressed");
        testForceSensorIsPressed.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON ForceSensor.is_pressed() #######");
            console.log("Test: Execute this test while pressing on a Force Sensor connected at port A");
            var force_sensor = new mySPIKE.ForceSensor("A");
            var isPressed = force_sensor.is_pressed();
            console.log("is pressed? ", isPressed);
            console.log("Expected Result: get true when force sensor is pressed, false otherwise");
            console.log("###### ENDING UNIT TEST ON ForceSensor.is_pressed() #######");
        })

        var testForceSensorWaitUntilPress = document.getElementById("forceSensorWaitUntilPress");
        testForceSensorWaitUntilPress.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON ForceSensor.wait_until_pressed() #######");
            console.log("Test: Execute this test and then after some time press on a Force Sensor connected at port A");
            var force_sensor = new mySPIKE.ForceSensor("A");
            force_sensor.wait_until_pressed( function () {
                console.log("Force Sensor press event handler");
                console.log("###### ENDING UNIT TEST ON ForceSensor.wait_until_pressed() #######");
            })
            console.log("Expected Result: when pressed, console logs 'Force Sensor press event handler'");
        })

        var testForceSensorWaitUntilRelease = document.getElementById("forceSensorWaitUntilRelease");
        testForceSensorWaitUntilRelease.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON ForceSensor.wait_until_released() #######");
            console.log("Test: Execute this test and then after some time press on a Force Sensor connected at port A and then release it");
            var force_sensor = new mySPIKE.ForceSensor("A");
            force_sensor.wait_until_released( function() {
                console.log("Force Sensor release event handler");
                console.log("###### ENDING UNIT TEST ON ForceSensor.wait_until_released() #######");
            })
            console.log("Expected Result: when force sensor RELEASED, console logs 'Force Sensor release event handler'");
        })
        
        //                                      //
        //            Speaker Tests             //
        //                                      //

        
        var testBeep = document.getElementById("beep");
        testBeep.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON Primehub.speaker.beep(100,3) #######")
            console.log("Test: Hub will beep for 3 seconds")
            var hub = mySPIKE.PrimeHub();
            var speaker = hub.speaker;
            console.log("speaker object", speaker);
            speaker.beep(100, 3);
            console.log("###### ENDING UNIT TEST ON Primehub.speaker.beep(100,3)#######")
        })
        
        var testStartBeep = document.getElementById("startBeep");
        testStartBeep.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON Primehub.speaker.start_beep(100) #######")
            console.log("Test: Hub will beep unless stopped (use speaker.stop())");
            var hub = mySPIKE.PrimeHub();
            var speaker = hub.speaker;
            speaker.start_beep(100);
            console.log("###### ENDING UNIT TEST ON Primehub.speaker.start_beep(100)#######")
        })

        var testStopBeep = document.getElementById("stopBeep");
        testStopBeep.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON Primehub.speaker.stop() #######")
            console.log("hub beeping will stop");
            var hub = mySPIKE.PrimeHub();
            var speaker = hub.speaker;
            speaker.stop();
            console.log("###### ENDING UNIT TEST ON Primehub.speaker.stop() #######")
        })

        //                                      //
        //              Button Tests            //
        //                                      //

        
        var testButtonIsPressed = document.getElementById("buttonIsPress");
        testButtonIsPressed.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON button.is_pressed() #######");
            console.log("Test: start the test pressing either the left button or the right button");
            
            
            var left_button = hub.left_button;
            var right_button = hub.right_button;
            
            if (left_button.is_pressed()) {
                console.log("left_button is pressed");
            }
            
            if (right_button.is_pressed()) {
                console.log("right_button is pressed");
            }
            console.log("Expected result: the console logs whether the button is pressed");
            console.log("###### ENDING UNIT TEST ON button.is_pressed() #######");
        })
        
        var testButtonWasPressed = document.getElementById("buttonWasPress");
        testButtonWasPressed.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON button.was_pressed() #######");
            console.log("Test: press either the left button or the right button. Then, after some time start the test.");
            
            
            var left_button = hub.left_button;
            var right_button = hub.right_button;
            
            if (left_button.was_pressed()) {
                console.log("left_button was pressed");
            }
            
            if (right_button.was_pressed()) {
                console.log("right_button was pressed");
            }
            console.log("Expected result: console identifies previous button presses")
            console.log("###### ENDING UNIT TEST ON button.was_pressed() #######");
        })

        var testButtonWaitPressed = document.getElementById("buttonWaitPress");
        testButtonWaitPressed.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON button.wait_until_pressed() #######");
            console.log("Test: Start the test. Then, after some time press either left button or right button");
            

            var left_button = hub.left_button;
            var right_button = hub.right_button;

            console.log("waiting for left_button press")
            left_button.wait_until_pressed( function () {
                console.log("left_button was pressed");
                console.log("###### ENDING UNIT TEST ON button.wait_until_pressed() #######");
            })

            console.log("waiting for right_button press")
            right_button.wait_until_pressed( function () {
                console.log("right_button was pressed");
                console.log("###### ENDING UNIT TEST ON button.wait_until_pressed() #######");
            })

            console.log("Expected result: console identifies button presses")
        })
        
        
        var testButtonWaitRelease = document.getElementById("buttonWaitRelease");
        testButtonWaitRelease.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON button.wait_until_released() #######");
            console.log("Test: Start the test. Then, after some time press either left button or right button and release them");
            

            var left_button = hub.left_button;
            var right_button = hub.right_button;

            console.log("waiting for left_button release")
            left_button.wait_until_released(function () {
                console.log("left_button was released");
                console.log("###### ENDING UNIT TEST ON button.wait_until_released() #######");
            })

            console.log("waiting for right_button release")
            right_button.wait_until_released(function () {
                console.log("right_button was released");
                console.log("###### ENDING UNIT TEST ON button.wait_until_released() #######");
            })

            console.log("Expected result: console identifies button releases")
        })

        //                                      //
        //         ColorSensor Tests            //
        //                                      //

        var testGetColor = document.getElementById("getColor");
        testGetColor.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON ColorSensor('A').get_color() #######");
            console.log("Test: Connect color sensor to port A and start the test");
            var color_sensor = mySPIKE.ColorSensor("A");
            var color = await color_sensor.get_color();
            console.log("Detected color: ", color);

            console.log("###### ENDING UNIT TEST ON ColorSensor('A').get_color() #######");
        })

        //                                      //
        //          ultrasonic Tests            //
        //                                      //

        var testLightUp = document.getElementById("lightup");
            testLightUp.addEventListener("click", async function () {
                console.log("###### BEGINNING UNIT TEST ON DistanceSensor('A').light_up(100,100,100,100) #######");
                console.log("Test: Connect color sensor to port A and start the test");
                var distance_sensor = mySPIKE.DistanceSensor("A");
                distance_sensor.light_up(100,100,100,100);
                console.log("###### ENDING UNIT TEST ON DistanceSensor('A').light_up(100,100,100,100) #######");
        })

        //                                      //
        //            program Tests             //
        //                                      //

        var testWriteProgram = document.getElementById("writeProgram");
        testWriteProgram.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON writeProgram() #######");
            console.log("Test: write hello world progam on slot 1 in python");
            console.log("write your python command for SPIKE on textbox and press write program");
            
            var writeProgramButton = document.getElementById("writeTheProgram");
            
            writeProgramButton.addEventListener("click", function () {
                var dataTextBox = document.getElementById("writeProgramData");
                
                var dataToWrite = dataTextBox.value;

                console.log(dataToWrite);
                /* using writeProgram (old way) */
                // var programname = "test program"
                // mySPIKE.writeProgram(btoa(programname), dataToWrite, 1);

                /* using micropython (new way) */
                mySPIKE.micropython(0, dataToWrite);
            })
            console.log("###### ENDING UNIT TEST ON writeProgram() #######");
        })

        var testMicropython = document.getElementById("micropython");
        testMicropython.addEventListener("click", function () {
//             mySPIKE.writeProgram("micropython test", 
//                 `
// from spike import PrimeHub, LightMatrix, Motor, MotorPair
// from spike.control import wait_for_seconds, wait_until, Timer

// hub = PrimeHub()

// hub.light_matrix.show_image('HAPPY')
//                 `, "10", function () {
//                     mySPIKE.executeProgram("10");
//                 }
//             );

        parseCommand(`
from spike import PrimeHub, LightMatrix, Motor, MotorPair
from spike.control import wait_for_seconds, wait_until, Timer

hub = PrimeHub() 

hub.light_matrix.write(run_for_seconds(2))

run_for_seconds(3)
        `)
        })

        //parse the cloudTagValue() command inserted at the textbox and execute it
        async function parseCommand(rawContent) {

            let index_runForSeconds = await rawContent.indexOf("run_for_seconds(");
            if ( index_runForSeconds > -1 ) {
                //find the index of rawContent at which the runForSeconds function ends
                let index_lastparen = await rawContent.indexOf(")", index_runForSeconds);

                //divide the rawContent into parts before the runForSeconds and after
                let first_rawContent_part = await rawContent.substring(0, index_runForSeconds);
                let second_rawContent_part = await rawContent.substring(index_lastparen + 1, rawContent.length);

                //find the argument of the runForSeconds
                let runForSeconds_string = await rawContent.substring(index_runForSeconds, index_lastparen + 1);
                let index_first_paren = runForSeconds_string.indexOf("(");
                let index_last_paren = runForSeconds_string.indexOf(")");
                let tagName = runForSeconds_string.substring(index_first_paren + 1, index_last_paren);

                // get the tag's value from the cloud
                var yield = "yield(" + tagName + "000)";

                //send the final UJSONRPC script to the hub.
                let final_RPC_command;

                console.log("typeof", typeof yield);

                final_RPC_command = await first_rawContent_part + yield + second_rawContent_part;

                return parseCommand(final_RPC_command);
            }
            else {
                console.log(rawContent);
                return rawContent;
            }
        }

        var testConcatProgram = document.getElementById("concatenateProgram");
        testConcatProgram.addEventListener("click", function () {
            console.log("###### BEGINNING UNIT TEST ON source code for concatenating micropy with template.py #######");
            console.log("Test: write micropy program in the textbox");

            var writeProgramButton = document.getElementById("writeTheProgram");

            writeProgramButton.addEventListener("click", function () {
                var firstPart = "from runtime import VirtualMachine\n\n# Stack for execution:\nasync def stack_1(vm, stack):\n"
                var secondPart = "# Setup for execution:\ndef setup(rpc, system, stop):\n\n # Initialize VM:\n    vm = VirtualMachine(rpc, system, stop, \"Target__1\")\n\n    # Register stack on VM:\n    vm.register_on_start(\"stack_1\", stack_1)\n\n    return vm"

                var dataTextBox = document.getElementById("writeProgramData");

                var dataToWrite = dataTextBox.value;

                var stringifiedData = JSON.stringify(dataToWrite);
                stringifiedData = stringifiedData.substring(1, stringifiedData.length-1);
                var result = "";

                var splitData = stringifiedData.split(/\\n/);
                console.log(splitData);
                for (var index in splitData) {

                    var addedTab = "    " + splitData[index] + "\n"; 
                    console.log(addedTab);
                    result = result + addedTab;
                }

                console.log("result before parsed: ")
                console.log("\n" + result);

                console.log("converted data without parse");
                result = firstPart + result + secondPart;
                console.log("converted data: ");
                console.log("\n" + result);


            })
            console.log("###### ENDING UNIT TEST ON source code for concatenating micropy with template.py #######");
        })

        var testGetProjects = document.getElementById("getProjects");
        testGetProjects.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON mySPIKE.getProjects() #######");
            
            var hubProjects = await mySPIKE.getProjects();
            console.log(hubProjects);
            console.log("Expected result: console log of an object listing all slots in the SPIKE Prime");
            console.log("###### ENDING UNIT TEST ON mySPIKE.getProjects()#######");
        })

        var testParseUJSON = document.getElementById("parseUJSON");
        testParseUJSON.addEventListener("click", async function () {

            var array = ['{ "m": 2, "p": ','[8.326, 100] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, 0, -176, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 383]], [61, [1, null, 7, 9, 7]], [62, [10]], [4, -8, 989], [0, 0, 0], [-4, ','0, 0], "", 0] }\r{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49',', [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [4, -8, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 383]], [61, [1, ','null, 7, 7, 7]], [62, [','10]]',', [4, -6, 989], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0',', 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]','], [62, [10]], [4, -7, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109',', 0]], [48, ','[0, 0, -177, 0]], ','[49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 8, 9, 7]], [62, [10]], [4, -6, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, ','0, -176, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61',', [1, null, 7, 9, 7]], [62, [10]], [4, -6, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48',', [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 9, 7]], [62, [10]], [4, -','6, 992], [0, 0, 0], [-4, 0, 0], ""',', 0] }\r','{ "m": 0, "p": [[48, [0, 0, ','109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [','62, [10]], [4, -5, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, ','[0, 0, -176, 0]], [49, [0, 0, ','166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [4, -6, 989], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, ','109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 383]], [61, [1, null, 7, 7, 7]], [62, [10]], [5, -8',', 991], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": ','[[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 383]], [61, [1, null, 7, 7, 7]], [62, [10]], [3, -7, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0',', "p": [[48, [0, 0, 109, 0]], [','48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 9, 7]], [62, [10]], [3, -10, 991], [','0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, ','0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 383]], [61, [1, n','ull, 7, 9, 7]], [62, [10]], [4, -5, 989], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48',', [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], ','[62, [10]], ','[5, -7, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ ','"m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [2, -8, ','989], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0',']], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0',']], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [4, -7, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [','[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 9, 7]], [62, [10]], [4, -8, 991], ','[0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [','0, 0, 109, 0]], [48, [0, 0, -176, 0]], [49, [0, 0, 166, 0]], [63, [0, ','0, 384]], [61, [1, null, 7, 9, 7]], [62, [10]], [4, -6, 990], [0, 0, 0','], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0',', 0, 109, 0]], [48, [0, ','0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 383]], [61, [1, null, 7, 7, 7]], [62, [10]], [4, -6, 992], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, ','7, 7]], [62, [10]], [6, -6, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r{ "m": 2, "p": [8.323, 100] }\r','{ "m": 0, "p": ','[[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [4, -6, 991], [0, 0, 0], [-4, ','0, 0], "", 0] }\r','{ "m": 0, "p": [[48, ','[0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [4, -5, 991], [0, 0, 0], [-4, 0, ','0], "", 0] }\r','{ "m": 0, "p": [[48, [','0, 0, 109, 0]], [48, [0, 0, -177, 0]], [','49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 8, 9, 7]], [62, [10]], [5, -7, 991], [0, 0, 0], [-4, ','0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, ','0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1',', null, 7, 9, 7]], [62, [10',']], [4, -7, 991], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0',', "p": [[48, [0, 0, 109, 0',']], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]','], [4, -5, 989], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [','[48, [0, 0, 1','09, 0]], [48, [','0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [3, -7, 991], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [','[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [','61, [1, null, 7, 7, 7]], [62, [10]], [5, -7, 991], [0, 0, 0], [-4',', 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 383]], [61, [1, null, 7, 7, 7]], [62, [10]], [6, -5, 989], [0, 0, 0], [-4, 0, 0], ','"", 0] }\r','{ "m": 0, "p": [[48, ','[0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [','1, null, 7, 7, 7]]',', [62, [10]], [4, -7, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0',', "p": [[48, [0, 0, 109, 0]], [48, [0, ','0, -177, 0]], [49, [0, ','0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 9, 7]], [62, [10]], ','[3, -6, 992], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109',', 0]], [48, [0, 0, -176, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]','], [4, ',' - 8, 991], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": ','[[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [','61, [1, null, 7, 7, 7]], [62, [10]], [5, -6, 989], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": ','[[48, [0, 0, 109, 0]], ','[48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [3, -7, 991], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0',', "p": [[48, [','0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, ','null, 7, 7, 7]], [62, [10]], [4, -7, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [','0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 9, 7]], [62, [10]], [5, -6, 991], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[','48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 9, 7]], [62, [10]], [4, -7, 990], [0, 0, 0]',', [-4, 0, 0], "", 0]','}\r','{ "m": 0, "p": [[48, [0, 0, ','109, 0]], [48, [0, 0, -176, 0]], [49, [0, 0, 166, ','0]], [63, [0, 0, 384]], [61, [1, null, 7, 9, 7]], [62, [10]], [3, -7, 989], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, ','[0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]]',', [62, [10]], [5, -6, 990]',', [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0',', "p": [[48, ','[0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 383]], [61, [1, null, 7, 7, 7]], [62, [10]], [3, -6, ','992], [0, 0, 0], [-4, 0, 0], "", 0]','}\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0',', 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [3, -8, 992], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 2, "p": [8.323, 100] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, ','[0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, ','384]], [61, [1, null, 7, 7, 7]], [62, [10]], [5, -7, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, ','109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 8, 9, 7]], [62',', [10]], [3, -6, 990], [0, 0, 0], [-4',', 0, 0], "", 0] }\r','{ "m": 0, "p": ','[[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 9, 7]], [62, [','10]], [4, -6, 991], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0, 0, 109, 0]], [','48, [0, 0, -177, 0]], ','[49, [0, 0, 166, 0]], [63, [0, 0, 383]], [61, [1, null, 7, 7, 7]], [62, [10]], [4, -8, 989], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": ','[[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]','], [62, [1','0]], [4, -6, 989], [0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, [0',', 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 7, 7]], [62, [10]], [3, -7, 992], [','0, 0, 0], [-4, 0, 0], "", 0] }\r','{ "m": 0, "p": [[48, ','[0, 0, ','109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 8, 9, 7]], [62, [10]], [','3,- 7, 989], [0, 0, 0], [-4, 0, 0], "", 0]}\r', '{ "m": 0, "p": [[', '48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], ', '[61, [1, null, 7, 9, 7]], [62, [10]], [4, -6, 990], [0, 0, 0], [-4, 0, 0], "", 0] }\r ', '{ "m": 0, "p": [[48, [0, 0, 109, 0]], [48, [0, 0, -177, 0]], [49, [0, 0, 166, 0]], [63, [0, 0, 384]], [61, [1, null, 7, 9, 7]], [62, [10', ']], [4, -7, 990], [0, 0, 0], [-4, 0, 0], ', '"", 0] }\r {"i": "ECSn", "r": ', '{ "blocksize": 512', ', "transferid": "53766" }', '}\r' ]
            var array2 = ['']
            parseUJSON(array);

            async function parseUJSON(streamArray) {

                console.log("here");

                //define for json concatenation
                let jsonline = "";

                // contains latest full json object from SPIKE readings
                let lastUJSONRPC;

                for ( var index in streamArray ) {
                    var value = streamArray[index];
                    //concatenate UJSONRPC packets into complete JSON objects
                    if (value) {
                        // stringify the packet to look for carriage return
                        var json_string = await JSON.stringify(value);

                        let findEscapedQuotes = /\\"/g;
                        let findNewLines = /\\n/g;

                        var cleanedJsonString = json_string.replace(findEscapedQuotes, '"');
                        cleanedJsonString = cleanedJsonString.substring(1, cleanedJsonString.length - 1);
                        // cleanedJsonString = cleanedJsonString.replace(findNewLines,'');

                        jsonline = jsonline + cleanedJsonString; // concatenate packet to data

                        // regex search for carriage return
                        let pattern = /\\r/g;
                        var carriageReIndex = jsonline.search(pattern);

                        // there is at least one carriage return in this packet
                        if (carriageReIndex > -1) {

                            // the concatenated packets start with a left curly brace (start of JSON)
                            if (jsonline[0] == "{" || jsonline.substring(0, 2) == " {") {

                                lastUJSONRPC = jsonline.substring(0, carriageReIndex);

                                // look for conjoined JSON packets: there's at least two carriage returns in jsonline
                                if (jsonline.match(/\\r/g).length > 1) {

                                    var conjoinedPacketsArray = jsonline.split(/\\r/); // array that split jsonline by \r

                                    // last index only contains "" as it would be after \r
                                    for (var i = 0; i < conjoinedPacketsArray.length - 1; i++) {

                                        // for every JSON object in array, perform data handling

                                        lastUJSONRPC = conjoinedPacketsArray[i];

                                        try {
                                            var parseTest = await JSON.parse(lastUJSONRPC)

                                            // // update hub information using lastUJSONRPC
                                            // await updateHubPortsInfo();
                                            // await PrimeHubEventHandler();

                                            // if (funcWithStream) {
                                            //     await funcWithStream();
                                            // }
                                            console.log("lastUJSONRPC: ", lastUJSONRPC);

                                        }
                                        catch (e) {
                                            console.log(e);
                                            console.log("error parsing lastUJSONRPC: ", lastUJSONRPC);
                                            console.log("current jsonline: ", jsonline);
                                            console.log("current cleaned json_string: ", cleanedJsonString)
                                            console.log("current json_string: ", json_string);
                                            console.log("current value: ", value);

                                            // if (funcAfterError != undefined) {
                                            //     funcAfterError("Fatal Error: Please refresh this environment");
                                            // }

                                        }

                                        jsonline = "";

                                    }
                                }
                                else {
                                    lastUJSONRPC = jsonline.substring(0, carriageReIndex);

                                    // // parsing test
                                    try {
                                        var parseTest = await JSON.parse(lastUJSONRPC)

                                        // // update hub information using lastUJSONRPC
                                        // await updateHubPortsInfo();
                                        // await PrimeHubEventHandler();

                                        // if (funcWithStream) {
                                        //     await funcWithStream();
                                        // }
                                        console.log("lastUJSONRPC: ", lastUJSONRPC);
                                    }
                                    catch (e) {
                                        console.log(e);
                                        console.log("error parsing lastUJSONRPC: ", lastUJSONRPC);
                                        console.log("current jsonline: ", jsonline);
                                        console.log("current cleaned json_string: ", cleanedJsonString)
                                        console.log("current json_string: ", json_string);
                                        console.log("current value: ", value);
                                        console.log("from a jsonline that has only one carriage return")

                                        // if (funcAfterError != undefined) {
                                        //     funcAfterError("Fatal Error: Please refresh this environment");
                                        // }

                                    }

                                    jsonline = jsonline.substring(carriageReIndex+1, jsonline.length);
                                }

                            }
                            // there was a carriage return in jsonline but a full JSON object wasnt formed
                            // usually when it's the first packet
                            else {

                                console.log("RESETTING JSONLINE WOOOOOOOOOO")
                                console.log("jsonline: ", jsonline);
                                // reset jsonline for next concatenation
                                jsonline = "";
                            }
                        }

                    }
                }
            }
        
        })
        // DROPPED FEATURE AND TEST IS NOT CORRECT
        var testWaitForSeconds = document.getElementById("waitForSeconds");
        testWaitForSeconds.addEventListener("click", function () {
            mySPIKE.micropython(0, `
from spike import PrimeHub
from spike.control import wait_for_seconds
def sub_func():
    hub.light_matrix.write('HAPPY')
    wait_for_seconds(2)
    hub.light_matrix.write('SAD')

hub = PrimeHub()
hub.light_matrix.write('start')
wait_for_seconds(2)
hub.light_matrix.write('start2')
sub_func()
hub.light_matrix.write('done')
            `);
        })




        //                                      //
        //               Misc Tests             //
        //                                      //

        var testSetHubOrientation = document.getElementById("setHubOri");
        testSetHubOrientation.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON setHubOrientation() #######");
            console.log("Test: Move the hub to an orientation and press the test button to see if the measured orientation is correct");
            mySPIKE.setHubOrientation();
            console.log("###### ENDING UNIT TEST ON setHubOrientation() #######");
        })

        var testUJSONRPC = document.getElementById("testUJSONRPC");
        testUJSONRPC.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON UJSONRPC.displayText #######");
            console.log("Expected Result: 'hello' on hub display");
            mySPIKE.UJSONRPC.displayText("hello");
            console.log("###### ENDING UNIT TEST ON UJSONRPC.displayText #######");
        })

        var testNew = document.getElementById("testNewKeyword");
        testNew.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON new keywords with Motor connected to port A #######");
            console.log("Test: see the difference of using 'new' keyword on SPIKE device object instantiations");
            console.log("motor1 = mySPIKE.Motor('A')")
            console.log("motor2 = new mySPIKE.Motor('A')")
            console.log("motor1's default speed changed to 50")
            var motor1 = mySPIKE.Motor("A");
            motor1.set_default_speed(50);

            var motor1_defaultSpeed = motor1.get_default_speed();

            console.log("motor1's default_speed, ", motor1_defaultSpeed);
            
            var motor2 = new mySPIKE.Motor("A");
            var motor2_defaultSpeed = motor2.get_default_speed();
            console.log("motor2's default_speed, ", motor2_defaultSpeed);

            console.log("###### ENDING UNIT TEST ON new keywords with Motor connected to port A #######");
        });

        var testNew1 = document.getElementById("testNewKeyword1");
        testNew1.addEventListener("click", async function () {
            console.log("###### BEGINNING UNIT TEST ON two Motor objects declared without 'new' keywords #######");
            console.log("Test: see if Motor objects defined without 'new' keywords cause issues");
            console.log("motor1 = mySPIKE.Motor('A')")
            console.log("motor2 = mySPIKE.Motor('B')")
            console.log("motor1's default speed changed to 50")
            var motor1 = mySPIKE.Motor("A");
            motor1.set_default_speed(50);
            var motor1_defaultSpeed = motor1.get_default_speed();
            console.log("motor1's default_speed, ", motor1_defaultSpeed);
            var motor2 = mySPIKE.Motor("B");
            var motor2_defaultSpeed = motor2.get_default_speed();
            console.log("motor2's default_speed, ", motor2_defaultSpeed);
            console.log("###### ENDING UNIT TEST ON two Motor objects declared without 'new' keywords #######");
        });

        var testGetMotors = document.getElementById("testGetMotors");
        testGetMotors.addEventListener("click", async function () {
            var motors = await mySPIKE.getMotors();
            console.log(motors);
        })
        
        /* test mySPIKE.getMotorPorts() */
        var test_getMotorPorts = document.getElementById("getMotorPorts");
        test_getMotorPorts.addEventListener("click", async function () {
            var motorPorts = await mySPIKE.getMotorPorts();
            console.log(motorPorts);
        })

        var testUJSONRPCdisplayClear = document.getElementById("displayClear")
        testUJSONRPCdisplayClear.addEventListener("click", function () {
            mySPIKE.UJSONRPC.displayClear();
            
        })
        var testUJSONRPCdisplaySetPixel = document.getElementById("displaySetPixel")
        testUJSONRPCdisplaySetPixel.addEventListener("click", function () {
            mySPIKE.UJSONRPC.displaySetPixel(0, 0, 100);
            
        })
        var testUJSONRPCdisplayText = document.getElementById("displayText")
        testUJSONRPCdisplayText.addEventListener("click", function () {
            mySPIKE.UJSONRPC.displayText('hello');
            
        })
        var testUJSONRPCmotorGoRelPos = document.getElementById("motorGoRelPos")
        testUJSONRPCmotorGoRelPos.addEventListener("click", function () {
                mySPIKE.UJSONRPC.motorGoRelPos('A', 180, 100, true, true)
            
        })
        var testUJSONRPCmotorGoRelPos1 = document.getElementById("motorGoRelPos1")
        testUJSONRPCmotorGoRelPos1.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorGoRelPos('A', 180, 100, false, true)
            
        })
        var testUJSONRPCmotorGoRelPos2 = document.getElementById("motorGoRelPos2")
        testUJSONRPCmotorGoRelPos2.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorGoRelPos('A', 180, 100, true, false)
            
        })
        var testUJSONRPCmotorGoRelPos3 = document.getElementById("motorGoRelPos3")
        testUJSONRPCmotorGoRelPos3.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorGoRelPos('A', 180, 100, false, false)
            
        })
        var testUJSONRPCmotorPwm = document.getElementById("motorPwm")
        testUJSONRPCmotorPwm.addEventListener("click", function () {
 
                mySPIKE.UJSONRPC.motorPwm('A', 100, true)
        })
        var testUJSONRPCmotorPwm1 = document.getElementById("motorPwm1")
        testUJSONRPCmotorPwm1.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorPwm('A', 100, false)
            
        })
        var testUJSONRPCmotorRunDegrees = document.getElementById("motorRunDegrees")
        testUJSONRPCmotorRunDegrees.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorRunDegrees('A', 400, 100, true, true)
        })
        var testUJSONRPCmotorRunDegrees1 = document.getElementById("motorRunDegrees1")
        testUJSONRPCmotorRunDegrees1.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorRunDegrees('A', 400, 100, false, true)
            
        })
        var testUJSONRPCmotorRunDegrees2 = document.getElementById("motorRunDegrees2")
        testUJSONRPCmotorRunDegrees2.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorRunDegrees('A', 400, 100, true, false)
        })
        var testUJSONRPCmotorRunDegrees3 = document.getElementById("motorRunDegrees3")
        testUJSONRPCmotorRunDegrees3.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorRunDegrees('A', 400, 100, false, false)

        })
        var testUJSONRPCmotorRunTimed = document.getElementById("motorRunTimed")
        testUJSONRPCmotorRunTimed.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorRunTimed('A', 3000, 100, true, true)

        })
        var testUJSONRPCmotorRunTimed1 = document.getElementById("motorRunTimed1")
        testUJSONRPCmotorRunTimed1.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorRunTimed('A', 3000, 100, false, true)

        })
        var testUJSONRPCmotorRunTimed2 = document.getElementById("motorRunTimed2")
        testUJSONRPCmotorRunTimed2.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorRunTimed('A', 3000, 100, true, false)

        })
        var testUJSONRPCmotorRunTimed3 = document.getElementById("motorRunTimed3")
        testUJSONRPCmotorRunTimed3.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorRunTimed('A', 3000, 100, false, false)

        })
        var testUJSONRPCmotorStart = document.getElementById("motorStart")
        testUJSONRPCmotorStart.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorStart('A', 100, true)

        })
        var testUJSONRPCmotorStart1 = document.getElementById("motorStart1")
        testUJSONRPCmotorStart1.addEventListener("click", function () {
            mySPIKE.UJSONRPC.motorStart('A', 100, false)

        })
        var testUJSONRPCmoveTankDegrees = document.getElementById("moveTankDegrees")
        testUJSONRPCmoveTankDegrees.addEventListener("click", function () {
            mySPIKE.UJSONRPC.moveTankDegrees(300, 100, 100, 'A', 'B', true)

        })
        var testUJSONRPCmoveTankDegrees1 = document.getElementById("moveTankDegrees1")
        testUJSONRPCmoveTankDegrees1.addEventListener("click", function () {
            mySPIKE.UJSONRPC.moveTankDegrees(300, 100, 100, 'A', 'B', false)

        })
        var testUJSONRPCmoveTankPowers = document.getElementById("moveTankPowers")
        testUJSONRPCmoveTankPowers.addEventListener("click", function () {
            mySPIKE.UJSONRPC.moveTankPowers(100, 100, 'A', 'B')

        })
        var testUJSONRPCmoveTankSpeeds = document.getElementById("moveTankSpeeds")
        testUJSONRPCmoveTankSpeeds.addEventListener("click", function () {
            mySPIKE.UJSONRPC.moveTankSpeeds(100, 100, 'A', 'B')

        })
        var testUJSONRPCmoveTankTime = document.getElementById("moveTankTime")
        testUJSONRPCmoveTankTime.addEventListener("click", function () {
            mySPIKE.UJSONRPC.moveTankTime(3000, 100, 100, 'A', 'B', true)

        })
        var testUJSONRPCmoveTankTime1 = document.getElementById("moveTankTime1")
        testUJSONRPCmoveTankTime1.addEventListener("click", function () {
            mySPIKE.UJSONRPC.moveTankTime(3000, 100, 100, 'A', 'B', false)
        })
        var testUJSONRPCsoundBeep = document.getElementById("soundBeep")
        testUJSONRPCsoundBeep.addEventListener("click", function () {
            mySPIKE.UJSONRPC.soundBeep(100, 300)

        })
        var testUJSONRPCsoundStop = document.getElementById("soundStop")
        testUJSONRPCsoundStop.addEventListener("click", function () {
            mySPIKE.UJSONRPC.soundStop()
        })

        var testRandom = document.getElementById("random");
        testRandom.addEventListener("click", function () {
            mySPIKE.rebootHub();
        })

        //////////////////////////////////////////
        //                                      //
        //           SystemLink Testing         //
        //                                      //
        //////////////////////////////////////////

        /* test getTagsInfo */
        var getTagsInfo = document.getElementById("getTagsInfo");
        getTagsInfo.addEventListener("click", async function () {
            var tagsInfo = await mySL.getTagsInfo();
            console.log(tagsInfo);
        })

        /* test createNewTag */
        var createNewTag = document.getElementById("createNewTag");
        createNewTag.addEventListener("click", async function () {
            mySL.createTag("newTag", 4, async function () {
                var tagsInfo = await mySL.getTagsInfo();
                console.log(tagsInfo);
            });
        })

        /* test deleteTag */

        // create "newTag" and delete it
        var deleteTag = document.getElementById("deleteTag");
        deleteTag.addEventListener("click", async function () {
            console.log("creating 'newTag' with value 4 "); 
            
            // create 'newTag'
            mySL.createTag("newTag", 4, async function () {

                console.log("'newTag' was created");
                
                await sleep(1000);

                console.log(await mySL.getTagsInfo());
                //delete 'newTag'

                mySL.deleteTag("newTag", async function () {

                    console.log("'newTag' has been deleted")
                    console.log(await mySL.getTagsInfo());

                });
            });
        });

        // delete "newTag" once if it doesnt exist, twice if it does
        var deleteTag1 = document.getElementById("deleteTag1");
        deleteTag1.addEventListener("click", async function () {
            console.log("checking if 'newTag' exists");
            
            var tagsInfo = await mySL.getTagsInfo();
            var newTagExists = false;

            for ( key in tagsInfo ) {
                if ( key == "newTag" ) {
                    newTagExists = true;
                }
            }

            if ( newTagExists ) {

                console.log("newTag exists, deleting it twice")

                mySL.deleteTag("newTag", async function() {
                    console.log("newTag deleted");

                    await sleep(2000);

                    tagsInfo = await mySL.getTagsInfo();

                    console.log(tagsInfo);

                    mySL.deleteTag("newTag", async function() 
                    {
                        console.log("newTag deleted again");

                        await sleep(2000);

                        tagsInfo = await mySL.getTagsInfo();

                        console.log(tagsInfo);
                    })
                })
            } else {
                console.log("newTag doesn't exist, deleting it");
                mySL.deleteTag("newTag", async function () {
                    console.log("newTag deleted");

                    await sleep(2000);

                    tagsInfo = await mySL.getTagsInfo();

                    console.log(tagsInfo);
                })
            }
        });


        // just delete
        var deleteTag2 = document.getElementById("deleteTag2");
        deleteTag2.addEventListener("click", async function () {
            mySL.deleteTag("newTag", async function () {
                console.log("newTag deleted");

                await sleep(2000);

                tagsInfo = await mySL.getTagsInfo();

                console.log(tagsInfo);
            })
        });

        /* TEST setTagValue CASES*/

        var setTagValue = document.getElementById("setTagValue");
        setTagValue.addEventListener("click", async function () {
            console.log("creating 'newTag' with value 4 ");
            
            // create 'newTag'
            mySL.createTag("newTag", 4, async function () {
                
                console.log("'newTag' was created")
                
                await sleep(2000);

                console.log(await mySL.getTagsInfo());
                
                //set tag value to 5
                mySL.setTagValue("newTag", 5);
                console.log("'newTag' value was changed to 5. run tagsinfo to check");
            });
        })

        var setINTtagwithString = document.getElementById("setINTtagwithString");
        setINTtagwithString.addEventListener("click", function() {
            console.log("changing an INT data type tag's value with string input");

            mySL.setTagValue("integer1", "1");

        })

        var setINTtagwithNumber = document.getElementById("setINTtagwithNumber");
        setINTtagwithNumber.addEventListener("click", function() {
            console.log("changing an INT data type tag's value with number input");

            mySL.setTagValue("integer1", 1);
        })

        var setSTRINGtagwithNumber = document.getElementById("setSTRINGtagwithNumber");
        setSTRINGtagwithNumber.addEventListener("click", function() {
            console.log("changing an STRING data type tag's value with number input");
            mySL.setTagValue("message", 1);
        })

        var setSTRINGtagwithString = document.getElementById("setSTRINGtagwithString");
        setSTRINGtagwithString.addEventListener("click", function() {
            console.log("changing an STRING data type tag's value with string input");
            mySL.setTagValue("message", "hi");
        })

        var setBOOLEANtagwithString = document.getElementById("setBOOLEANtagwithString");
        setBOOLEANtagwithString.addEventListener("click", function() {
            console.log("changing a BOOLEAN data type tag's value with string input");
            mySL.setTagValue("abool", "true");
        })

        window.addEventListener("load", function () {

            test_getMotorPorts.style.backgroundColor = "lightgreen";
            testBeep.style.backgroundColor = "lightgreen";
            testStartBeep.style.backgroundColor = "lightgreen";
            testStopBeep.style.backgroundColor = "lightgreen";
            testMotorRelPos.style.backgroundColor = "lightgreen";
            testMotorRelPos1.style.backgroundColor = "lightgreen";
            testWasGesture.style.backgroundColor = "lightgreen";
            testWaitForNewGesture.style.backgroundColor = "lightgreen";
            testWaitForNewOri.style.backgroundColor = "lightgreen";
            testSetHubOrientation.style.backgroundColor = "lightgreen";
            testForceSensorIsPressed.style.backgroundColor = "lightgreen";
            testForceSensorWaitUntilPress.style.backgroundColor = "lightgreen";
            testForceSensorWaitUntilRelease.style.backgroundColor = "lightgreen";
            testGetForceNewton.style.backgroundColor = "lightgreen";
            testGetForcePercentage.style.backgroundColor = "lightgreen";
            testGetAngles.style.backgroundColor = "lightgreen";
            testUJSONRPC.style.backgroundColor = "lightgreen";
            testGetGesture.style.backgroundColor = "lightgreen";
            testGetOrientation.style.backgroundColor = "lightgreen";
            testButtonIsPressed.style.backgroundColor = "lightgreen";
            testButtonWaitPressed.style.backgroundColor = "lightgreen";
            testButtonWaitRelease.style.backgroundColor = "lightgreen";
            testButtonWasPressed.style.backgroundColor = "lightgreen";
            testResetYaw.style.backgroundColor = "red";
            testResetYawSource.style.backgroundColor = "red";
            testMotorPairStop.style.backgroundColor = "lightgreen";
            testMotorPairMove.style.backgroundColor = "red";
            //testMotorPairStart
            testMotorPairMoveLeft.style.backgroundColor = "red";
            testMotorPairMoveRight.style.backgroundColor = "red";
            testMotorPairMoveLeftSlightly.style.backgroundColor = "red";
            testMotorPairMoveRightSlightly.style.backgroundColor = "red";

            // ujsonrpc functions
            testUJSONRPCdisplayClear.style.backgroundColor = "lightgreen";
            testUJSONRPCdisplaySetPixel.style.backgroundColor = "lightgreen";
            testUJSONRPCdisplayText.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorGoRelPos.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorGoRelPos1.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorGoRelPos2.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorGoRelPos3.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorPwm.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorPwm1.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorRunDegrees.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorRunDegrees1.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorRunDegrees2.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorRunDegrees3.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorRunTimed.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorRunTimed1.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorRunTimed2.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorRunTimed3.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorStart.style.backgroundColor = "lightgreen";
            testUJSONRPCmotorStart1.style.backgroundColor = "lightgreen";
            testUJSONRPCmoveTankDegrees.style.backgroundColor = "lightgreen";
            testUJSONRPCmoveTankDegrees1.style.backgroundColor = "lightgreen";
            testUJSONRPCmoveTankPowers.style.backgroundColor = "lightgreen";
            testUJSONRPCmoveTankSpeeds.style.backgroundColor = "lightgreen";
            testUJSONRPCmoveTankTime.style.backgroundColor = "lightgreen";
            testUJSONRPCmoveTankTime1.style.backgroundColor = "lightgreen";
            testUJSONRPCsoundBeep.style.backgroundColor = "lightgreen";
            testUJSONRPCsoundStop.style.backgroundColor = "lightgreen";

            getTagsInfo.style.backgroundColor = "lightgreen";
            createNewTag.style.backgroundColor = "lightgreen";
            setTagValue.style.backgroundColor = "lightgreen";

            SLTestDecisionHandler();
            SPIKETestDecisionHandler();

            var selectTest = document.getElementById("SL_test_select");
            
            selectTest.addEventListener("click", function () {
                SLTestDecisionHandler();
            })


            var SPIKEselectTest = document.getElementById("SPIKE_test_select");

            SPIKEselectTest.addEventListener("click", function () {
                SPIKETestDecisionHandler();
            })
        })

        function SLTestDecisionHandler() {
                            var testFunction = $("#SLselectTest option:selected").attr('id');

            if (testFunction == "getTagsInfoOPTION") {
                var testCases = document.getElementsByClassName("SLtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("getTagsInfo");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "deleteTagOPTION") {
                var testCases = document.getElementsByClassName("SLtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("deleteTag");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "createNewTagOPTION") {
                var testCases = document.getElementsByClassName("SLtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("createNewTag");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "setTagValueOPTION") {
                var testCases = document.getElementsByClassName("SLtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("setTagValue");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
        }

        function SPIKETestDecisionHandler() {
                            var testCases = undefined;
            var testFunction = $("#SPIKEselectTest option:selected").attr('id');

            if (testFunction == "motorOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("motor");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "motionOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("motion");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "speakerOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("speaker");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "miscOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("misc");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "buttonOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("button");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "forceOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("force");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "motorPairOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("motorPair");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "colorOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("color");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "programOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("program");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }
            else if (testFunction == "ultrasonicOPTION") {
                var testCases = document.getElementsByClassName("SPIKEtestCase");
                for (var index = 0; index < testCases.length; index++) {
                    testCases[index].style.display = "none";
                }

                var selectedCases = document.getElementsByClassName("ultrasonic");
                for (var index = 0; index < selectedCases.length; index++) {
                    var aCase = selectedCases[index];
                    aCase.style.display = "block";
                }
            }

        }

        //sleep function
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
    </script>
    <style>
        #SPIKEbox {
            position: absolute;
            top: 200px;
            left: 50px;
            height: 400px;
            width: 400px;
            background-color: #4CE0D2;
            border: solid;
        }

        #SLbox {
            position: absolute;
            top: 200px;
            left: 500px;
            height: 400px;
            width: 400px;
            background-color: #4CE0D2;
            border: solid;
        }

        .testCase {
            display:none;
            display:flex;
            flex-direction: column;
        }

        #SPIKE_test_select, #SL_test_select {
            background-color: rgb(247, 250, 48);
        }
    </style>
</html>